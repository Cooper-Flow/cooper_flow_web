<section class="lg:p-4 p-2">
  @if(isLoading()) {
  <app-loading></app-loading>
  } @else {
  @switch (registerData?.type) {
  @case ('entry') {
  <ng-container *ngTemplateOutlet="entryTemplate"></ng-container>
  }
  @case ('exit') {
  <ng-container *ngTemplateOutlet="exitTemplate"></ng-container>
  }
  }
  }
</section>

<ng-template #entryTemplate>
  <div class="mb-2 lg:flex items-center">
    <div class="mr-4 lg:mb-0 mb-4 flex items-center">
      <app-title text="Registro" [icon]="icon"></app-title>
      <span class="text-green-400 text-xl font-medium ml-2">Entrada {{ registerData?.Entry?.id }}</span>
    </div>
  </div>

  <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
    <mat-tab label="Entrada">
      <ng-container *ngTemplateOutlet="entryDetailTemplate"></ng-container>
    </mat-tab>

    <mat-tab label="Volumes">
      <ng-container *ngTemplateOutlet="volumesTemplate"></ng-container>
    </mat-tab>

    <mat-tab label="Histórico">
      <ng-container *ngTemplateOutlet="historicTemplate"></ng-container>
    </mat-tab>
  </mat-tab-group>


</ng-template>

<ng-template #entryDetailTemplate>
  <div class="px-2 py-4">

    <div class="mb-4">
      <div class="mb-1 mt-[-10px]">
        <span class="text-sm"><span class="font-medium text-gray-700">Produtor: </span>{{
          registerData?.Entry?.Producer?.Person?.name }}</span>
      </div>
    </div>

    <div class="mb-4">
      <div class="mb-1 mt-[-10px]">
        <span class="text-sm"><span class="font-medium text-gray-700">Responsável: </span>{{
          registerData?.Entry?.User?.Person?.name }}</span>
      </div>
    </div>

    <div class="mb-4">
      <div class="mb-1 mt-[-10px]">
        <span class="text-sm"><span class="font-medium text-gray-700">Referente: </span>{{
          regex.convertToBRTime(registerData?.Entry?.entry_at) }}</span>
      </div>
    </div>

    <div class="mb-8">
      <div class="mb-1 mt-[-10px]">
        <span class="text-sm"><span class="font-medium text-gray-700">Registrado em: </span>{{
          regex.convertToBRTime(registerData?.created_at) }}</span>
      </div>
    </div>

    <div class="mb-4">
      <div>
        <div class="mb-1 mt-[-10px]">
          <span class="text-sm"><span class="font-medium text-gray-700">Volumes iniciais ({{
              registerData?.Entry?.VolumeEnter?.length }})</span></span>
        </div>
      </div>

      @for (volume of registerData?.Entry?.VolumeEnter; track $index) {
      <div class="py-2 px-3 rounded-md border border-gray-400 mb-2">
        <div>
          <div class="mr-2 flex items-center">
            <div class="mr-2">
              <app-label [text]="volume.product_name"></app-label>
            </div>
            <span class="text-xs text-gray-800 rounded-full mr-2">• {{ volume.type }} •</span>
            <span class="text-xs text-gray-800 rounded-full">{{ volume.size }}</span>
          </div>
        </div>
        <div class="p-1 text-sm">
          <span class="font-medium mr-1">{{ regex.formatToTwoDigits(volume?.weight) + ' kg' }}</span>
          <!-- <span class="font-medium mr-2">• {{ volume.volume }} kg</span> -->
          <span class="text-xs text-gray-400">({{ volume?.Material ? volume?.Material?.name : 'avulso' }})</span>
        </div>
        <div class="p-1 text-sm">
          <span class="font-medium mr-1">Palete inicial:</span>
          <span>{{ volume?.Location?.name }}</span>
        </div>
      </div>
      }
    </div>
  </div>
</ng-template>

<ng-template #volumesTemplate>
  <div class="mb-4 p-4">
    <div>
      <div class="mb-1 mt-[-10px]">
        <span class="text-sm"><span class="font-medium text-gray-700">Situação atual dos volumes ({{
            registerData?.Entry?.Volume?.length }})</span></span>
      </div>
    </div>

    <div class="grid lg:grid-cols-3 md:grid-cols-2 grid-cols-1 gap-2">
      @for (volume of registerData?.Entry?.Volume; track $index) {
      <div [matMenuTriggerFor]="menu" class="transform active:scale-95 transition duration-150">
        <app-card-volume [item]="volume" />
      </div>
      <mat-menu #menu="matMenu" xPosition="before">
        <button mat-menu-item (click)="openLocationDialog(volume?.Location?.id)"
          class="flex items-center p-2 mb-2 hover:bg-gray-200 hover:cursor-pointer">
          <mat-icon class="mr-2">pallet</mat-icon>
          Ver palete
        </button>
      </mat-menu>
      }
    </div>

  </div>
</ng-template>

<ng-template #historicTemplate>
  <div class="mb-4 p-4">
    @for (log of registerData?.Entry?.VolumeLog; track $index) {
    <div class="mb-4 leading-3">
      <div>
        <span class="text-xs text-gray-400">{{ dateTime.convertToBRTime(log.created_at) }} por {{
          log?.User?.Person?.name }}</span>
      </div>
      <div>
        <span class="text-orange-400 text-xl mr-1">•</span>
        <span class="text-sm">{{ log?.origin_history}}</span>
      </div>
      <!-- <div>
          <span class="text-green-400 text-xl mr-1">•</span>
          <span class="text-sm">{{ log?.generated_history}}</span>
        </div> -->
    </div>
    }
  </div>
</ng-template>

<ng-template #exitTemplate>
  <div class="mb-2 lg:flex items-center">
    <div class="mr-4 lg:mb-0 mb-4 flex items-center">
      <app-title text="Registro" [icon]="icon"></app-title>
      <span class="text-red-400 text-xl font-medium ml-2">Saída{{ registerData?.Exit?.id }}</span>
    </div>
  </div>

  <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
    <mat-tab label="Entrada">
      <ng-container *ngTemplateOutlet="exitDetailTemplate"></ng-container>
    </mat-tab>

    <mat-tab label="Volumes">
      <ng-container *ngTemplateOutlet="volumesExitTemplate"></ng-container>
    </mat-tab>

  </mat-tab-group>
</ng-template>

<ng-template #exitDetailTemplate>
  <div class="px-2 py-4">

    <div class="mb-4">
      <div class="mb-1 mt-[-10px]">
        <span class="text-sm"><span class="font-medium text-gray-700">Cliente: </span>{{
          registerData?.Exit?.Person?.name }}</span>
      </div>
    </div>

    <div class="mb-4">
      <div class="mb-1 mt-[-10px]">
        <span class="text-sm"><span class="font-medium text-gray-700">Responsável: </span>{{
          registerData?.Exit?.User?.Person?.name }}</span>
      </div>
    </div>

    <div class="mb-4">
      <div class="mb-1 mt-[-10px]">
        <span class="text-sm"><span class="font-medium text-gray-700">Referente: </span>{{
          regex.convertToBRTime(registerData?.Entry?.entry_at) }}</span>
      </div>
    </div>

    <div class="mb-8">
      <div class="mb-1 mt-[-10px]">
        <span class="text-sm"><span class="font-medium text-gray-700">Registrado em: </span>{{
          regex.convertToBRTime(registerData?.created_at) }}</span>
      </div>
    </div>

  </div>
</ng-template>


<ng-template #volumesExitTemplate>
  <div class="mb-4 p-4">
    <div>
      <div class="mb-1 mt-[-10px]">
        <span class="text-sm"><span class="font-medium text-gray-700">Volumes de saída</span></span>
      </div>
    </div>

    <div class="grid lg:grid-cols-3 md:grid-cols-2 grid-cols-1 gap-2">
      @for (volume of registerData?.Exit?.Volume; track $index) {
      <div>
        <app-card-volume [item]="volume" />
      </div>
      }
    </div>
  </div>
</ng-template>
