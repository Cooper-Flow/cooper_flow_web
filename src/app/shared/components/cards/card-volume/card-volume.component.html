<ng-container>
  @if (line) {
  <ng-container *ngTemplateOutlet="lineTemp"></ng-container>
  }
  @else {
  <ng-container *ngTemplateOutlet="defaultTemp"></ng-container>
  }
</ng-container>

<ng-template #defaultTemp>
  <div class="pt-2 pl-2 bg-blue-50 rounded-md min-h-[5rem]" [ngClass]="{
  'hover:bg-gray-200 hover:scale-105 hover:cursor-pointer' :  !disableHover,
  'rounded-b-none ' : item.PricingItem?.length > 0,
  'w-[20rem]' : !small && !line,
  'border-[1px] border-gray-400 rounded-md  shadow-md' : !item.volume_group_id
  }">


    <div class="flex items-center mb-2">


      @if (small) {
      <div class="w-3 h-3 mr-2 rounded-full p-1.5" [style.background-color]="item?.Product.color"></div>
      }

      @else {
      <div class="w-9 h-9 mr-2 rounded-md p-1.5" [style.background-color]="item?.Product.color">
        <app-icon icon="box_white" customClass="" />
      </div>
      }

      <div>
        <div>
          <div class="mr-2 flex items-center">
            <div class="mr-2">
              <app-label [text]="item?.Product?.name"></app-label>
            </div>
            <span class="text-xs text-gray-800 rounded-full mr-2">• {{ item?.type }} •</span>
            <span class="text-xs text-gray-800 rounded-full">{{ item?.size }}</span>
          </div>
        </div>
      </div>

    </div>


    <div class="">
      <div class="py-1 px-2">

        <div class="mb-2">
          <div class="mb-1" matTooltip="Produtor">
            <div class="flex items-center ">
              <div class="flex items-center">
                <app-icon icon="farmer" customClass="w-5 h-5 opacity-80 mr-2" />
                <div class="pt-1">
                  <span class="text-sm font-medium">{{ item?.Entry?.Producer?.Person?.name }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="mb-1.5" matTooltip="Peso total">
            <div class="text-xs text-black font-medium rounded-tl-md flex items-center">
              <app-icon icon="weight" customClass="w-5 h-5 mr-2" />
              <div>
                <span class="">{{ item.weight | kg }}</span>
              </div>
            </div>
          </div>

          @if (!item.volume_group_id && !item.exited) {
          <div class="text-xs text-black font-medium rounded-tl-md flex items-center" matTooltip="Material">
            <app-icon icon="material" customClass="w-5 h-5 mr-2" />

            <div>
              <span class="text-xs">{{ item.Material ? item.Material.name : 'Avulso' }} </span>
              <span>
                = {{ calc.calcTotalUnits(item)}}
              </span>
            </div>
          </div>
          }
        </div>

        @if (item.volume_group_id) {
        <div class="flex items-center">
          <div class="pt-2 flex items-center justify-center">
            <mat-icon class="!text-xs !text-gray-600">group_work</mat-icon>
          </div>
          <div>
            <span class="text-xs text-gray-600">Agrupado</span>
          </div>
        </div>
        }

        @if (!small) {
        <div class="flex flex-wrap gap-x-4 gap-y-1 mb-1">
          <div>
            <span class="text-xs">Entrada {{ item?.entry_id }}</span>
          </div>
          <div>
            <span class="text-xs">Lote: {{ item?.Entry?.batch ?? '---' }}</span>
          </div>
          @if (item?.Entry?.field) {
          <div>
            <span class="text-xs">Talhão: {{ item?.Entry?.field ?? '---' }}</span>
          </div>
          }
        </div>
        <div class="font-normal text-xs text-end mt-1 flex items-center justify-end">
          @if (dateTime.checkNew(item.created_at)) {
          <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
          }
          <span [class]="dateTime.checkNew(item.created_at) ? 'text-green-500':'text-gray-500'"> {{
            dateTime.convertToBRTime(item.created_at) }} </span>
        </div>
        }
      </div>
    </div>

  </div>

</ng-template>

<ng-template #lineTemp>
  <div class="flex items-center">
    <div class="py-1 px-2 bg-blue-50 rounded-md w-full">

      <div class="flex items-center">

        <div class="w-3 h-3 mr-2 rounded-full" [style.background-color]="item?.Product.color"></div>

        <div class="flex items-center justify-between w-full">
          <div>
            <div class="mr-2 flex items-center">
              <div class="mr-2">
                <app-label [text]="item?.Product?.name"></app-label>
              </div>
              <span class="text-xs text-gray-800 rounded-full mr-2">• {{ item?.type }} •</span>
              <span class="text-xs text-gray-800 rounded-full">{{ item?.size }}</span>
            </div>
          </div>
          @if (item.volume_group_id) {
          <div class="flex items-center">
            <div class="pt-2 flex items-center justify-center">
              <mat-icon class="!text-xs !text-gray-600">group_work</mat-icon>
            </div>
            <div>
              <span class="text-xs text-gray-600">Agrupado</span>
            </div>
          </div>
          }
        </div>

      </div>


      <div class="">
        <div class="flex gap-2 items-center">
          <div class="" matTooltip="Peso total">
            <div class="text-xs text-black font-medium rounded-tl-md flex items-center">
              <app-icon icon="weight" customClass="w-5 h-5 mr-2" />
              <div>
                <span class="">{{ item.weight | kg }}</span>
              </div>
            </div>
          </div>
          <div class="text-xs text-black font-medium rounded-tl-md flex items-center" matTooltip="Material">
            <app-icon icon="material" customClass="w-5 h-5 mr-2" />

            <div>
              <span class="text-xs">{{ item.Material ? item.Material.name : 'Avulso' }} </span>
              <span>
                = {{ calc.calcTotalUnits(item)}}
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="">
        <div class="font-normal text-xs text-end  flex items-center justify-start pt-4">
          @if (dateTime.checkNew(item.created_at)) {
          <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
          }
          <span [class]="dateTime.checkNew(item.created_at) ? 'text-green-500':'text-gray-500'"> {{
            dateTime.convertToBRTime(item.created_at) }} </span>
        </div>
      </div>
    </div>
  </div>
</ng-template>
